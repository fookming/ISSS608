{
  "hash": "dec4c5a501cd1d41f33a4e430519a238",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on Exercise 8 - Part 2\"\nauthor: \"Ee Fook Ming\"\ndate: \"February 25, 2025\"\ndate-modified: last-modified\nexecute:\n  echo: true\n  eval: false\n  warning: false\n  freeze: true\n  fig-width: 12\n  fig-height: 8\nformat: \n  html:\n    number-sections: true\n    number-offset: [21, 0]  # Offset heading levels by starting at 22\noutput: \n  html_document: \n    toc: true\n    tabset: true\n---\n\n\n\n# Visualising Geospatial Point Data\n\n## Overview\n\nProportional symbol maps (also known as graduate symbol maps) are a\nclass of maps that use the visual variable of size to represent\ndifferences in the magnitude of a discrete, abruptly changing\nphenomenon, e.g. counts of people. Like choropleth maps, you can create\nclassed or unclassed versions of these maps. The classed ones are known\nas range-graded or graduated symbols, and the unclassed are called\nproportional symbols, where the area of the symbols are proportional to\nthe values of the attribute being mapped. In this hands-on exercise, you\nwill learn how to create a proportional symbol map showing the number\nof wins by Singapore Pools’ outlets using an R package called **tmap**.\n\n## Learning outcome\n\nBy the end of this hands-on exercise, you will acquire the following skills by using appropriate R packages:\n\n-   To import an aspatial data file into R.\n\n-   To convert it into simple point feature data frame and at the same\n    time, to assign an appropriate projection reference to the newly create\n    simple point feature data frame.\n\n-   To plot interactive proportional symbol maps.\n\n## Getting Started\n\nBefore we get started, we need to ensure that **tmap** package of R and other related R packages have been installed and loaded into R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, tidyverse)\n```\n:::\n\n\n\n## Geospatial Data Wrangling\n\n### The Data\n\nThe data set use for this hands-on exercise is called *SGPools_svy21*. The data is in csv file format.\n\nFigure below shows the first 15 records of SGPools_svy21.csv. It\nconsists of seven columns. The XCOORD and YCOORD columns are the\nx-coordinates and y-coordinates of SingPools outlets and branches. They\nare in [Singapore SVY21 Projected Coordinates System](https://www.sla.gov.sg/sirent/CoordinateSystems.aspx).\n\n![](images/clipboard-4278393375.png)\n\n### Data Import and Preparation\n\nThe code chunk below uses *read_csv()* function of **readr** package to import *SGPools_svy21.csv* into R as a tibble data frame called *sgpools*.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsgpools <- read_csv(\"data/aspatial/SGPools_svy21.csv\")\n```\n:::\n\n\n\nAfter importing the data file into R, it is important for us to examine if the data file has been imported correctly.\n\nThe code chunk below shows list() is used to do the job.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(sgpools) \n```\n:::\n\n\n\nNotice that the *sgpools* data in tibble data frame and not the common R data frame.\n\n### Creating a **sf** data frame from an aspatial data frame\n\nThe code chunk below converts sgpools data frame into a simple feature data frame by using *st_as_sf()* of **sf** packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsgpools_sf <- st_as_sf(sgpools, \n                       coords = c(\"XCOORD\", \"YCOORD\"),\n                       crs= 3414)\n```\n:::\n\n\n\nThings to learn from the arguments above:\n\n-   The *coords* argument requires you to provide the column name\n    of the x-coordinates first then followed by the column name of the\n    y-coordinates.\n\n-   The *crs* argument required you to provide the coordinates system in epsg format. [EPSG: 3414](https://epsg.io/3414) is Singapore SVY21 Projected Coordinate System. You can search for other country’s epsg code by refering to [epsg.io](https://epsg.io/).\n\nFigure below shows the data table of *sgpools_sf*. Notice that a new column called geometry has been added into the data frame.\n\n![](https://r4va.netlify.app/chap22/img/image2.jpg)\n\nYou can display the basic information of the newly created sgpools_sf by using the code chunk below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(sgpools_sf)\n```\n:::\n\n\n\nThe output shows that sgppols_sf is in point feature class. It’s epsg ID\nis 3414. The bbox provides information of the extend of the geospatial\ndata.\n\n### Drawing Proportional Symbol Map\n\nTo create an interactive proportional symbol map in R, the view mode of tmap will be used.\n\nThe code churn below will turn on the interactive mode of tmap.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"view\")\n```\n:::\n\n\n\n### It all started with an interactive point symbol map\n\nThe code chunks below are used to create an interactive point symbol map.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(sgpools_sf)+\ntm_bubbles(col = \"red\",\n           size = 1,\n           border.col = \"black\",\n           border.lwd = 1)\n```\n:::\n\n\n\n### Lets make it proportional\n\nTo draw a proportional symbol map, we need to assign a numerical\nvariable to the size visual attribute. The code chunks below show that\nthe variable *Gp1Gp2Winnings* is assigned to size visual attribute.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(sgpools_sf)+\ntm_bubbles(col = \"red\",\n           size = \"Gp1Gp2 Winnings\",\n           border.col = \"black\",\n           border.lwd = 1)\n```\n:::\n\n\n\n### Lets give it a different colour\n\nThe proportional symbol map can be further improved by using the colour visual attribute. In the code chunks below, *OUTLET_TYPE* variable is used as the colour attribute variable.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(sgpools_sf)+\ntm_bubbles(col = \"OUTLET TYPE\", \n          size = \"Gp1Gp2 Winnings\",\n          border.col = \"black\",\n          border.lwd = 1)\n```\n:::\n\n\n\n### I have a twin brothers :)\n\nAn impressive and little-know feature of **tmap**’s view mode is that it also works with faceted plots. The argument *sync* in *tm_facets()* can be used in this case to produce multiple maps with synchronised zoom and pan settings.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(sgpools_sf) +\n  tm_bubbles(col = \"OUTLET TYPE\", \n          size = \"Gp1Gp2 Winnings\",\n          border.col = \"black\",\n          border.lwd = 1) +\n  tm_facets(by= \"OUTLET TYPE\",\n            nrow = 1,\n            sync = TRUE)\n```\n:::\n\n\n\nBefore you end the session, it is wiser to switch **tmap**’s Viewer back to plot mode by using the code chunk below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n:::\n\n\n\n## Reference\n\n### All about **tmap** package\n\n-   [tmap: Thematic Maps in R](https://www.jstatsoft.org/article/view/v084i06)\n\n-   [tmap](https://cran.r-project.org/web/packages/tmap/index.html)\n\n-   [tmap: get started!](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html)\n\n-   [tmap: changes in version 2.0](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-changes-v2.html)\n\n-   [tmap: creating thematic maps in a flexible way (useR!2015)](http://von-tijn.nl/tijn/research/presentations/tmap_user2015.pdf)\n\n-   [Exploring and presenting maps with tmap (useR!2017)](http://von-tijn.nl/tijn/research/presentations/tmap_user2017.pdf)\n\n### Geospatial data wrangling\n\n-   [sf: Simple Features for R](https://cran.r-project.org/web/packages/sf/index.html)\n\n-   [Simple Features for R: StandardizedSupport for Spatial Vector Data](https://journal.r-project.org/archive/2018/RJ-2018-009/RJ-2018-009.pdf)\n\n-   [Reading, Writing and Converting Simple Features](https://cran.r-project.org/web/packages/sf/vignettes/sf2.html)\n\n### Data wrangling\n\n-   [dplyr](https://dplyr.tidyverse.org/)\n\n-   [Tidy data](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)\n\n-   [tidyr: Easily Tidy Data with ‘spread()’ and ‘gather()’ Functions](https://cran.r-project.org/web/packages/tidyr/tidyr.pdf)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}